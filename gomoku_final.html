<!DOCTYPE html>
<html>
<head>
    <title>äº”å­æ£‹ - AIå°æˆ°ç‰ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            min-height: 100vh;
        }
        
        .game-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: inline-block;
            margin: 20px auto;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .game-info {
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            color: #555;
        }
        
        .mode-selection {
            margin: 20px 0;
        }
        
        .difficulty-selection {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .board {
            display: inline-block;
            background: #deb887;
            border: 3px solid #8b4513;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .row {
            display: flex;
        }
        
        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid #8b4513;
            background: #f4e4bc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .cell:hover {
            background: #e6d3a3;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .hidden {
            display: none;
        }
        
        .thinking {
            color: #ff6b6b;
            font-style: italic;
        }

        /* æ£‹å­æ¨£å¼ */
        .stone {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
            position: relative;
        }

        .stone.black {
            background: radial-gradient(circle at 30% 30%, #555, #000);
            border-color: #222;
        }

        .stone.white {
            background: radial-gradient(circle at 30% 30%, #fff, #ddd);
            border-color: #666;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3), inset 0 1px 3px rgba(255,255,255,0.8);
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿé©é… */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                margin: 10px;
            }
            
            .board {
                padding: 15px;
            }
            
            .cell {
                width: 30px;
                height: 30px;
                font-size: 20px;
            }
            
            .stone {
                width: 24px;
                height: 24px;
            }
            
            button {
                padding: 10px 18px;
                font-size: 14px;
                margin: 3px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .game-info {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .board {
                padding: 10px;
            }
            
            .cell {
                width: 25px;
                height: 25px;
                font-size: 18px;
            }
            
            .stone {
                width: 20px;
                height: 20px;
            }
            
            button {
                padding: 8px 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ® äº”å­æ£‹éŠæˆ²</h1>
        
        <!-- æ¨¡å¼é¸æ“‡ -->
        <div class="mode-selection" id="modeSelection">
            <div class="game-info">è«‹é¸æ“‡éŠæˆ²æ¨¡å¼ï¼š</div>
            <button class="btn-success" onclick="selectAIMode()">ğŸ¤– vs é›»è…¦</button>
            <button class="btn-primary" onclick="selectLocalMode()">ğŸ‘¥ æœ¬åœ°å°æˆ°</button>
            <button class="btn-secondary" onclick="testFunction()">ğŸ§ª æ¸¬è©¦æŒ‰éˆ•</button>
        </div>
        
        <!-- é›£åº¦é¸æ“‡ -->
        <div class="difficulty-selection" id="difficultySelection">
            <div class="game-info">é¸æ“‡AIé›£åº¦ï¼š</div>
            <button class="btn-success" onclick="startAIGame('easy')">ğŸ˜Š ç°¡å–®</button>
            <button class="btn-warning" onclick="startAIGame('medium')">ğŸ¤” ä¸­ç­‰</button>
            <button class="btn-secondary" onclick="startAIGame('hard')">ğŸ˜¤ å›°é›£</button>
            <br><br>
            <button class="btn-primary" onclick="backToModeSelection()">â†©ï¸ è¿”å›</button>
        </div>
        
        <!-- éŠæˆ²ç‹€æ…‹ -->
        <div class="game-info" id="gameInfo">æ­¡è¿ä¾†åˆ°äº”å­æ£‹éŠæˆ²ï¼</div>
        
        <!-- æ£‹ç›¤ -->
        <div class="board hidden" id="gameBoard"></div>
        
        <!-- éŠæˆ²æ§åˆ¶ -->
        <div class="controls hidden" id="gameControls">
            <button class="btn-secondary" onclick="backToModeSelection()">ğŸ  é‡æ–°é–‹å§‹</button>
            <button class="btn-primary" onclick="restartCurrentGame()">ğŸ”„ é‡æ–°ä¸€å±€</button>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡
        var board = [];
        var currentPlayer = 1; // 1=é»‘æ£‹(â—), 2=ç™½æ£‹(â—‹)
        var gameStarted = false;
        var gameMode = null; // 'ai' æˆ– 'local'
        var aiDifficulty = 'medium';
        var isAIThinking = false;

        // æ¸¬è©¦å‡½æ•¸
        function testFunction() {
            alert('ğŸ‰ æ­å–œï¼æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼\n\nä½ å¯ä»¥é¸æ“‡ï¼š\nâ€¢ vs é›»è…¦ï¼šèˆ‡AIå°æˆ°\nâ€¢ æœ¬åœ°å°æˆ°ï¼šé›™äººéŠæˆ²');
            console.log('æ¸¬è©¦æˆåŠŸ');
        }

        // é¸æ“‡AIæ¨¡å¼
        function selectAIMode() {
            console.log('é¸æ“‡AIæ¨¡å¼');
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('difficultySelection').style.display = 'block';
        }

        // é¸æ“‡æœ¬åœ°æ¨¡å¼
        function selectLocalMode() {
            console.log('é¸æ“‡æœ¬åœ°æ¨¡å¼');
            gameMode = 'local';
            startGame();
        }

        // é–‹å§‹AIéŠæˆ²
        function startAIGame(difficulty) {
            console.log('é–‹å§‹AIéŠæˆ²ï¼Œé›£åº¦ï¼š' + difficulty);
            gameMode = 'ai';
            aiDifficulty = difficulty;
            startGame();
        }

        // è¿”å›æ¨¡å¼é¸æ“‡
        function backToModeSelection() {
            console.log('è¿”å›æ¨¡å¼é¸æ“‡');
            document.getElementById('modeSelection').style.display = 'block';
            document.getElementById('difficultySelection').style.display = 'none';
            document.getElementById('gameBoard').classList.add('hidden');
            document.getElementById('gameControls').classList.add('hidden');
            gameStarted = false;
            gameMode = null;
            document.getElementById('gameInfo').innerHTML = 'æ­¡è¿ä¾†åˆ°äº”å­æ£‹éŠæˆ²ï¼';
        }

        // é–‹å§‹éŠæˆ²
        function startGame() {
            console.log('é–‹å§‹éŠæˆ²ï¼Œæ¨¡å¼ï¼š' + gameMode);
            gameStarted = true;
            currentPlayer = 1;
            isAIThinking = false;
            
            // éš±è—é¸æ“‡ç•Œé¢
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('difficultySelection').style.display = 'none';
            
            // é¡¯ç¤ºéŠæˆ²ç•Œé¢
            document.getElementById('gameBoard').classList.remove('hidden');
            document.getElementById('gameControls').classList.remove('hidden');
            
            // åˆå§‹åŒ–æ£‹ç›¤
            board = [];
            for (var i = 0; i < 15; i++) {
                board[i] = [];
                for (var j = 0; j < 15; j++) {
                    board[i][j] = 0;
                }
            }
            
            createBoard();
            updateGameInfo();
        }

        // é‡æ–°é–‹å§‹ç•¶å‰éŠæˆ²
        function restartCurrentGame() {
            console.log('é‡æ–°é–‹å§‹ç•¶å‰éŠæˆ²');
            startGame();
        }

        // å‰µå»ºæ£‹ç›¤
        function createBoard() {
            var gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            
            for (var row = 0; row < 15; row++) {
                var rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                
                for (var col = 0; col < 15; col++) {
                    var cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.onclick = function() {
                        var r = parseInt(this.dataset.row);
                        var c = parseInt(this.dataset.col);
                        clickCell(r, c);
                    };
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    rowDiv.appendChild(cell);
                }
                
                gameBoard.appendChild(rowDiv);
            }
        }

        // é»æ“Šæ ¼å­
        function clickCell(row, col) {
            console.log('é»æ“Šæ ¼å­: ' + row + ',' + col);
            
            if (!gameStarted || isAIThinking) {
                return;
            }
            
            if (board[row][col] !== 0) {
                return;
            }
            
            // AIæ¨¡å¼ä¸‹åªèƒ½ç©å®¶(é»‘æ£‹)ä¸‹æ£‹
            if (gameMode === 'ai' && currentPlayer !== 1) {
                return;
            }
            
            // ä¸‹æ£‹
            placeStone(row, col, currentPlayer);
            
            // æª¢æŸ¥å‹åˆ©
            if (checkWin(row, col)) {
                var winner = currentPlayer === 1 ? 'é»‘æ£‹' : 'ç™½æ£‹';
                alert('ğŸ‰ ' + winner + ' ç²å‹ï¼');
                document.getElementById('gameInfo').innerHTML = 'ğŸ† ' + winner + ' ç²å‹ï¼';
                gameStarted = false;
                return;
            }
            
            // åˆ‡æ›ç©å®¶
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateGameInfo();
            
            // AIå›åˆ
            if (gameMode === 'ai' && currentPlayer === 2 && gameStarted) {
                setTimeout(aiMove, 800);
            }
        }

        // æ”¾ç½®æ£‹å­
        function placeStone(row, col, player) {
            board[row][col] = player;
            var cell = document.querySelector('[data-row="' + row + '"][data-col="' + col + '"]');
            
            // å‰µå»ºå¯¦é«”æ£‹å­
            var stone = document.createElement('div');
            stone.className = 'stone ' + (player === 1 ? 'black' : 'white');
            cell.innerHTML = '';
            cell.appendChild(stone);
            cell.style.cursor = 'not-allowed';
        }

        // AIä¸‹æ£‹
        function aiMove() {
            if (!gameStarted || currentPlayer !== 2) return;
            
            isAIThinking = true;
            document.getElementById('gameInfo').innerHTML = '<span class="thinking">ğŸ¤– AIæ€è€ƒä¸­...</span>';
            
            setTimeout(function() {
                var move = getBestAIMove();
                if (move) {
                    placeStone(move.row, move.col, 2);
                    
                    // æª¢æŸ¥AIæ˜¯å¦ç²å‹
                    if (checkWin(move.row, move.col)) {
                        alert('ğŸ¤– AIç²å‹ï¼å†ä¾†ä¸€å±€å§ï¼');
                        document.getElementById('gameInfo').innerHTML = 'ğŸ¤– AIç²å‹ï¼';
                        gameStarted = false;
                        isAIThinking = false;
                        return;
                    }
                    
                    // åˆ‡æ›å›ç©å®¶
                    currentPlayer = 1;
                    isAIThinking = false;
                    updateGameInfo();
                }
            }, aiDifficulty === 'hard' ? 1200 : aiDifficulty === 'medium' ? 800 : 400);
        }

        // ç²å–AIæœ€ä½³ç§»å‹•
        function getBestAIMove() {
            var availableMoves = [];
            for (var row = 0; row < 15; row++) {
                for (var col = 0; col < 15; col++) {
                    if (board[row][col] === 0) {
                        availableMoves.push({row: row, col: col});
                    }
                }
            }
            
            if (availableMoves.length === 0) return null;
            
            // æ ¹æ“šé›£åº¦é¸æ“‡ç­–ç•¥
            if (aiDifficulty === 'easy') {
                return getRandomMove(availableMoves);
            } else if (aiDifficulty === 'medium') {
                return getMediumMove(availableMoves);
            } else {
                return getHardMove(availableMoves);
            }
        }

        // ç°¡å–®AI - åŸºæœ¬æ”»é˜² + éš¨æ©Ÿ
        function getRandomMove(moves) {
            // 1. æª¢æŸ¥èƒ½å¦ä¸€æ­¥ç²å‹
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 2;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 2. æª¢æŸ¥æ˜¯å¦éœ€è¦é˜»æ“‹ç©å®¶ç²å‹
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 1;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 3. åå¥½ä¸­å¤®å€åŸŸ
            var centerMoves = [];
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                if (Math.abs(move.row - 7) <= 4 && Math.abs(move.col - 7) <= 4) {
                    centerMoves.push(move);
                }
            }
            
            var candidates = centerMoves.length > 0 ? centerMoves : moves;
            return candidates[Math.floor(Math.random() * candidates.length)];
        }

        // ä¸­ç­‰AI - å¼·åŒ–æ”»é˜²ç­–ç•¥
        function getMediumMove(moves) {
            // 1. æª¢æŸ¥èƒ½å¦ç²å‹
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 2;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 2. æª¢æŸ¥éœ€è¦é˜²å®ˆ(é˜»æ­¢å°æ‰‹ç²å‹)
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 1;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 3. æª¢æŸ¥èƒ½å¦å½¢æˆæ´»å››æˆ–é›™ä¸‰
            var attackMoves = [];
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                var attackScore = evaluateAttackMove(move.row, move.col, 2);
                if (attackScore >= 80) {
                    attackMoves.push({move: move, score: attackScore});
                }
            }
            
            if (attackMoves.length > 0) {
                attackMoves.sort(function(a, b) { return b.score - a.score; });
                return attackMoves[0].move;
            }
            
            // 4. æª¢æŸ¥éœ€è¦é˜»æ­¢å°æ‰‹å½¢æˆå¨è„…
            var defenseMoves = [];
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                var defenseScore = evaluateAttackMove(move.row, move.col, 1);
                if (defenseScore >= 60) {
                    defenseMoves.push({move: move, score: defenseScore});
                }
            }
            
            if (defenseMoves.length > 0) {
                defenseMoves.sort(function(a, b) { return b.score - a.score; });
                return defenseMoves[0].move;
            }
            
            // 5. é¸æ“‡è©•åˆ†æœ€é«˜çš„ä½ç½®
            var bestMove = null;
            var bestScore = -1;
            
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                var score = evaluatePosition(move.row, move.col);
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            }
            
            return bestMove || getRandomMove(moves);
        }

        // å›°é›£AI - é«˜ç´šç­–ç•¥åˆ†æ
        function getHardMove(moves) {
            // 1. æª¢æŸ¥èƒ½å¦ç²å‹
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 2;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 2. æª¢æŸ¥éœ€è¦é˜²å®ˆï¼ˆé˜»æ­¢ç©å®¶ç²å‹ï¼‰
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                board[move.row][move.col] = 1;
                if (checkWin(move.row, move.col)) {
                    board[move.row][move.col] = 0;
                    return move;
                }
                board[move.row][move.col] = 0;
            }
            
            // 3. æª¢æŸ¥èƒ½å¦å½¢æˆæ´»å››æˆ–é›™ä¸‰
            var threatMoves = [];
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                var threatScore = calculateThreatScore(move.row, move.col, 2);
                if (threatScore >= 500) {
                    threatMoves.push({move: move, score: threatScore});
                }
            }
            
            if (threatMoves.length > 0) {
                threatMoves.sort(function(a, b) { return b.score - a.score; });
                return threatMoves[0].move;
            }
            
            // 4. æª¢æŸ¥éœ€è¦é˜»æ­¢ç©å®¶å½¢æˆå¨è„…
            var defenseMoves = [];
            for (var i = 0; i < moves.length; i++) {
                var move = moves[i];
                var defenseScore = calculateThreatScore(move.row, move.col, 1);
                if (defenseScore >= 300) {
                    defenseMoves.push({move: move, score: defenseScore});
                }
            }
            
            if (defenseMoves.length > 0) {
                defenseMoves.sort(function(a, b) { return b.score - a.score; });
                return defenseMoves[0].move;
            }
            
            // 5. é¸æ“‡æœ€ä½³æˆ°ç•¥ä½ç½®
            var bestMove = null;
            var bestScore = -1;
            
            for (var i = 0; i < Math.min(moves.length, 12); i++) {
                var move = moves[i];
                var score = calculatePositionValue(move.row, move.col);
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            }
            
            return bestMove || getMediumMove(moves);
        }

        // è©•ä¼°ä½ç½®åˆ†æ•¸
        function evaluatePosition(row, col) {
            var score = 0;
            
            // ä¸­å¤®ä½ç½®åŠ åˆ†
            var centerDistance = Math.abs(row - 7) + Math.abs(col - 7);
            score += Math.max(0, 14 - centerDistance);
            
            // æª¢æŸ¥å‘¨åœæ˜¯å¦æœ‰å·±æ–¹æ£‹å­
            var directions = [[0,1], [1,0], [1,1], [1,-1], [0,-1], [-1,0], [-1,-1], [-1,1]];
            for (var d = 0; d < directions.length; d++) {
                var dx = directions[d][0];
                var dy = directions[d][1];
                var newRow = row + dx;
                var newCol = col + dy;
                
                if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15) {
                    if (board[newRow][newCol] === 2) {
                        score += 10; // å·±æ–¹æ£‹å­é™„è¿‘
                    } else if (board[newRow][newCol] === 1) {
                        score += 5; // å°æ‰‹æ£‹å­é™„è¿‘(é˜²å®ˆ)
                    }
                }
            }
            
            return score;
        }

        // è©•ä¼°æ”»æ“Šç§»å‹•åˆ†æ•¸
        function evaluateAttackMove(row, col, player) {
            var score = 0;
            var directions = [[0,1], [1,0], [1,1], [1,-1]];
            
            for (var d = 0; d < directions.length; d++) {
                var count = countConsecutive(row, col, directions[d][0], directions[d][1], player);
                
                // æ ¹æ“šé€£å­æ•¸çµ¦åˆ†
                if (count >= 5) score += 10000; // äº”é€£ç²å‹
                else if (count >= 4) score += 1000; // å››é€£
                else if (count >= 3) score += 100; // ä¸‰é€£
                else if (count >= 2) score += 20; // äºŒé€£
                else score += 2;
                
                // æª¢æŸ¥æ˜¯å¦æœ‰ç©ºä½å½¢æˆæ´»æ£‹
                if (count >= 2 && isLiveLine(row, col, directions[d][0], directions[d][1], player, count)) {
                    score += count * 50;
                }
            }
            
            return score;
        }

        // è¨ˆç®—é€£çºŒæ£‹å­æ•¸ï¼ˆæ¨¡æ“¬åœ¨è©²ä½ç½®æ”¾ç½®æ£‹å­å¾Œçš„é€£å­æ•¸ï¼‰
        function countConsecutive(row, col, dx, dy, player) {
            // æš«æ™‚æ”¾ç½®æ£‹å­
            board[row][col] = player;
            var count = 1;
            
            // æ­£æ–¹å‘
            for (var i = 1; i < 5; i++) {
                var newRow = row + dx * i;
                var newCol = col + dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) break;
                count++;
            }
            
            // è² æ–¹å‘
            for (var i = 1; i < 5; i++) {
                var newRow = row - dx * i;
                var newCol = col - dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) break;
                count++;
            }
            
            // æ¢å¾©æ£‹ç›¤ç‹€æ…‹
            board[row][col] = 0;
            return count;
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºæ´»æ£‹ï¼ˆå…©ç«¯éƒ½æœ‰ç©ºä½ï¼‰
        function isLiveLine(row, col, dx, dy, player, count) {
            if (count < 2) return false;
            
            // æš«æ™‚æ”¾ç½®æ£‹å­ä¾†æª¢æŸ¥
            board[row][col] = player;
            
            var frontEmpty = false, backEmpty = false;
            var frontCount = 0, backCount = 0;
            
            // è¨ˆç®—æ­£æ–¹å‘é€£å­æ•¸
            for (var i = 1; i < 5; i++) {
                var newRow = row + dx * i;
                var newCol = col + dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) {
                    frontEmpty = (board[newRow][newCol] === 0);
                    break;
                }
                frontCount++;
            }
            
            // è¨ˆç®—è² æ–¹å‘é€£å­æ•¸
            for (var i = 1; i < 5; i++) {
                var newRow = row - dx * i;
                var newCol = col - dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) {
                    backEmpty = (board[newRow][newCol] === 0);
                    break;
                }
                backCount++;
            }
            
            // æ¢å¾©æ£‹ç›¤ç‹€æ…‹
            board[row][col] = 0;
            
            return frontEmpty && backEmpty && (frontCount + backCount + 1) >= count;
        }

        // Minimaxç®—æ³•ï¼ˆAlpha-Betaå‰ªæï¼‰
        function minimax(row, col, player, depth, isMaximizing, alpha, beta) {
            // æ¨¡æ“¬ä¸‹æ£‹
            board[row][col] = player;
            
            // æª¢æŸ¥éŠæˆ²çµæŸ
            if (checkWin(row, col)) {
                board[row][col] = 0;
                return isMaximizing ? 10000 - depth : -10000 + depth;
            }
            
            if (depth === 0) {
                var score = evaluateBoard();
                board[row][col] = 0;
                return score;
            }
            
            var moves = getAvailableMoves();
            if (moves.length === 0) {
                board[row][col] = 0;
                return 0; // å¹³å±€
            }
            
            var bestScore = isMaximizing ? -Infinity : Infinity;
            
            for (var i = 0; i < Math.min(moves.length, 8); i++) {
                var move = moves[i];
                var nextPlayer = player === 1 ? 2 : 1;
                var score = minimax(move.row, move.col, nextPlayer, depth - 1, !isMaximizing, alpha, beta);
                
                if (isMaximizing) {
                    bestScore = Math.max(bestScore, score);
                    alpha = Math.max(alpha, score);
                } else {
                    bestScore = Math.min(bestScore, score);
                    beta = Math.min(beta, score);
                }
                
                if (beta <= alpha) break; // Alpha-Betaå‰ªæ
            }
            
            board[row][col] = 0;
            return bestScore;
        }

        // ç²å–å¯ç”¨ç§»å‹•ï¼ˆå„ªå…ˆè€ƒæ…®æœ‰åƒ¹å€¼çš„ä½ç½®ï¼‰
        function getAvailableMoves() {
            var moves = [];
            var hasStones = false;
            
            // å…ˆæª¢æŸ¥æ£‹ç›¤ä¸Šæ˜¯å¦æœ‰æ£‹å­
            for (var r = 0; r < 15; r++) {
                for (var c = 0; c < 15; c++) {
                    if (board[r][c] !== 0) {
                        hasStones = true;
                        break;
                    }
                }
                if (hasStones) break;
            }
            
            for (var row = 0; row < 15; row++) {
                for (var col = 0; col < 15; col++) {
                    if (board[row][col] === 0) {
                        // å¦‚æœæ£‹ç›¤ç‚ºç©ºï¼Œè¿”å›ä¸­å¤®ä½ç½®
                        if (!hasStones) {
                            if (row === 7 && col === 7) {
                                return [{row: row, col: col, score: 100}];
                            }
                            continue; // è·³éå…¶ä»–ä½ç½®
                        }
                        // åªè€ƒæ…®é™„è¿‘æœ‰æ£‹å­çš„ä½ç½®
                        if (!hasStones || hasAdjacentStone(row, col)) {
                            moves.push({row: row, col: col, score: evaluatePosition(row, col)});
                        }
                    }
                }
            }
            
            // æŒ‰åˆ†æ•¸æ’åº
            moves.sort(function(a, b) { return b.score - a.score; });
            return moves;
        }

        // æª¢æŸ¥é™„è¿‘æ˜¯å¦æœ‰æ£‹å­
        function hasAdjacentStone(row, col) {
            for (var dr = -2; dr <= 2; dr++) {
                for (var dc = -2; dc <= 2; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    var newRow = row + dr;
                    var newCol = col + dc;
                    if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15) {
                        if (board[newRow][newCol] !== 0) return true;
                    }
                }
            }
            return false;
        }

        // è©•ä¼°æ•´å€‹æ£‹ç›¤
        function evaluateBoard() {
            var score = 0;
            
            for (var row = 0; row < 15; row++) {
                for (var col = 0; col < 15; col++) {
                    if (board[row][col] === 2) {
                        score += evaluateAttackMove(row, col, 2);
                    } else if (board[row][col] === 1) {
                        score -= evaluateAttackMove(row, col, 1);
                    }
                }
            }
            
            return score;
        }

        // è¨ˆç®—å¨è„…åˆ†æ•¸ï¼ˆç”¨æ–¼å›°é›£AIï¼‰
        function calculateThreatScore(row, col, player) {
            var score = 0;
            var directions = [[0,1], [1,0], [1,1], [1,-1]];
            
            for (var d = 0; d < directions.length; d++) {
                var dx = directions[d][0];
                var dy = directions[d][1];
                
                // è¨ˆç®—è©²æ–¹å‘çš„é€£å­æƒ…æ³
                var lineInfo = analyzeDirection(row, col, dx, dy, player);
                
                if (lineInfo.count >= 4) {
                    score += 2000; // æ´»å››æˆ–æ²–å››
                } else if (lineInfo.count >= 3) {
                    if (lineInfo.openEnds >= 2) {
                        score += 800; // æ´»ä¸‰
                    } else if (lineInfo.openEnds >= 1) {
                        score += 200; // æ²–ä¸‰
                    }
                } else if (lineInfo.count >= 2) {
                    if (lineInfo.openEnds >= 2) {
                        score += 100; // æ´»äºŒ
                    } else if (lineInfo.openEnds >= 1) {
                        score += 20; // æ²–äºŒ
                    }
                }
            }
            
            return score;
        }

        // åˆ†ææŸå€‹æ–¹å‘çš„æ£‹å­æ’åˆ—
        function analyzeDirection(row, col, dx, dy, player) {
            // æš«æ™‚æ”¾ç½®æ£‹å­
            board[row][col] = player;
            
            var count = 1;
            var openEnds = 0;
            
            // æ­£æ–¹å‘è¨ˆç®—
            var frontCount = 0;
            var frontBlocked = false;
            for (var i = 1; i < 6; i++) {
                var newRow = row + dx * i;
                var newCol = col + dy * i;
                
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) {
                    frontBlocked = true;
                    break;
                }
                
                if (board[newRow][newCol] === player) {
                    frontCount++;
                } else if (board[newRow][newCol] === 0) {
                    // é‡åˆ°ç©ºä½ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰æ•ˆé–‹å£
                    if (frontCount > 0) openEnds++;
                    break;
                } else {
                    frontBlocked = true;
                    break;
                }
            }
            
            // è² æ–¹å‘è¨ˆç®—
            var backCount = 0;
            var backBlocked = false;
            for (var i = 1; i < 6; i++) {
                var newRow = row - dx * i;
                var newCol = col - dy * i;
                
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) {
                    backBlocked = true;
                    break;
                }
                
                if (board[newRow][newCol] === player) {
                    backCount++;
                } else if (board[newRow][newCol] === 0) {
                    // é‡åˆ°ç©ºä½ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰æ•ˆé–‹å£
                    if (backCount > 0) openEnds++;
                    break;
                } else {
                    backBlocked = true;
                    break;
                }
            }
            
            count += frontCount + backCount;
            
            // æª¢æŸ¥å…©ç«¯é–‹å£
            if (!frontBlocked && frontCount === 0) {
                var frontRow = row + dx;
                var frontCol = col + dy;
                if (frontRow >= 0 && frontRow < 15 && frontCol >= 0 && frontCol < 15 && board[frontRow][frontCol] === 0) {
                    openEnds++;
                }
            }
            
            if (!backBlocked && backCount === 0) {
                var backRow = row - dx;
                var backCol = col - dy;
                if (backRow >= 0 && backRow < 15 && backCol >= 0 && backCol < 15 && board[backRow][backCol] === 0) {
                    openEnds++;
                }
            }
            
            // æ¢å¾©æ£‹ç›¤ç‹€æ…‹
            board[row][col] = 0;
            
            return {count: count, openEnds: openEnds};
        }

        // è¨ˆç®—ä½ç½®ç¶œåˆåƒ¹å€¼ï¼ˆç”¨æ–¼å›°é›£AIï¼‰
        function calculatePositionValue(row, col) {
            var score = 0;
            
            // åŸºç¤ä½ç½®åˆ†æ•¸
            score += evaluatePosition(row, col);
            
            // æ”»æ“Šæ½›åŠ›
            var attackScore = calculateThreatScore(row, col, 2);
            score += attackScore * 1.5;
            
            // é˜²å®ˆåƒ¹å€¼
            var defenseScore = calculateThreatScore(row, col, 1);
            score += defenseScore * 1.0;
            
            // æˆ°ç•¥ä½ç½®åŠ åˆ†
            var strategicValue = getStrategicValue(row, col);
            score += strategicValue;
            
            return score;
        }

        // ç²å–æˆ°ç•¥ä½ç½®åƒ¹å€¼
        function getStrategicValue(row, col) {
            var score = 0;
            
            // ä¸­å¤®å€åŸŸåŠ åˆ†
            var centerDistance = Math.abs(row - 7) + Math.abs(col - 7);
            score += Math.max(0, 10 - centerDistance);
            
            // æª¢æŸ¥æ˜¯å¦èƒ½åŒæ™‚å½±éŸ¿å¤šå€‹æ–¹å‘
            var directions = [[0,1], [1,0], [1,1], [1,-1]];
            var activeDirections = 0;
            
            for (var d = 0; d < directions.length; d++) {
                var dx = directions[d][0];
                var dy = directions[d][1];
                var hasNearbyStone = false;
                
                // æª¢æŸ¥è©²æ–¹å‘2æ ¼å…§æ˜¯å¦æœ‰æ£‹å­
                for (var i = -2; i <= 2; i++) {
                    if (i === 0) continue;
                    var newRow = row + dx * i;
                    var newCol = col + dy * i;
                    
                    if (newRow >= 0 && newRow < 15 && newCol >= 0 && newCol < 15) {
                        if (board[newRow][newCol] !== 0) {
                            hasNearbyStone = true;
                            break;
                        }
                    }
                }
                
                if (hasNearbyStone) activeDirections++;
            }
            
            score += activeDirections * 5;
            
            return score;
        }

        // æª¢æŸ¥æ˜¯å¦æœƒå‰µé€ é›™æ´»ä¸‰
        function createsDoubleThree(row, col, player) {
            board[row][col] = player;
            var threeCount = 0;
            var directions = [[0,1], [1,0], [1,1], [1,-1]];
            
            for (var d = 0; d < directions.length; d++) {
                if (countInDirection(row, col, directions[d][0], directions[d][1], player) === 3) {
                    threeCount++;
                }
            }
            
            board[row][col] = 0;
            return threeCount >= 2;
        }

        // è¨ˆç®—æŸæ–¹å‘é€£å­æ•¸
        function countInDirection(row, col, dx, dy, player) {
            var count = 1;
            
            // æ­£æ–¹å‘
            for (var i = 1; i < 5; i++) {
                var newRow = row + dx * i;
                var newCol = col + dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) break;
                count++;
            }
            
            // è² æ–¹å‘
            for (var i = 1; i < 5; i++) {
                var newRow = row - dx * i;
                var newCol = col - dy * i;
                if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                if (board[newRow][newCol] !== player) break;
                count++;
            }
            
            return count;
        }

        // æª¢æŸ¥å‹åˆ©
        function checkWin(row, col) {
            var player = board[row][col];
            var directions = [[0,1], [1,0], [1,1], [1,-1]];
            
            for (var d = 0; d < directions.length; d++) {
                var dx = directions[d][0];
                var dy = directions[d][1];
                var count = 1;
                
                // æ­£æ–¹å‘æª¢æŸ¥
                for (var i = 1; i < 5; i++) {
                    var newRow = row + dx * i;
                    var newCol = col + dy * i;
                    if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                    if (board[newRow][newCol] !== player) break;
                    count++;
                }
                
                // è² æ–¹å‘æª¢æŸ¥
                for (var i = 1; i < 5; i++) {
                    var newRow = row - dx * i;
                    var newCol = col - dy * i;
                    if (newRow < 0 || newRow >= 15 || newCol < 0 || newCol >= 15) break;
                    if (board[newRow][newCol] !== player) break;
                    count++;
                }
                
                if (count >= 5) return true;
            }
            
            return false;
        }

        // æ›´æ–°éŠæˆ²ä¿¡æ¯
        function updateGameInfo() {
            if (gameMode === 'ai') {
                if (currentPlayer === 1) {
                    document.getElementById('gameInfo').innerHTML = 'ä½ çš„å›åˆ (é»‘æ£‹ â—)';
                } else {
                    document.getElementById('gameInfo').innerHTML = 'AIå›åˆ (ç™½æ£‹ â—‹)';
                }
            } else {
                var playerName = currentPlayer === 1 ? 'é»‘æ£‹ â—' : 'ç™½æ£‹ â—‹';
                document.getElementById('gameInfo').innerHTML = 'è¼ªåˆ° ' + playerName + ' ä¸‹æ£‹';
            }
        }

        // é é¢è¼‰å…¥å®Œæˆ
        window.onload = function() {
            console.log('äº”å­æ£‹éŠæˆ²è¼‰å…¥å®Œæˆ');
        };
    </script>
</body>
</html>